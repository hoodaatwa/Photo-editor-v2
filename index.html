<!DOCTYPE html>
<html>
<head>

<style>
    #image {
        max-width: 100%; /* تعديل حسب الحاجة */
        max-height: 200px; /* تعديل حسب الحاجة */
        display: block; /* يمكنك تعديل هذا لتناسب تخطيطك */
    }
</style>




    
    <link  href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>


    <title>محرر الصور</title>
    <style>
        canvas {
            border: 1px solid #cccccc;
        }
    </style>
</head>
<body>
    <h2>محرر الصور بسيط</h2>
    <input type="file" id="imageLoader" name="imageLoader"/>




<button id="addText">إضافة نص</button>
<button id="undo">تراجع</button>
<button id="redo">إعادة</button>
<button id="saturation">زيادة التشبع</button>

<button id="grayscale">الأبيض والأسود</button>
<button id="brightness">زيادة السطوع</button>
<button id="contrast">زيادة التباين</button>
<button id="blur">ضبابية</button>



<button id="resize">تغيير حجم الصورة</button>

<button id="exportImage">تصدير الصورة</button>

<img id="image" style="display: none;"/>










    <canvas id="imageCanvas" width="800" height="600"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
    <script>
var canvas = new fabric.Canvas('imageCanvas');
document.getElementById('imageLoader').addEventListener('change', function (e) {
    var reader = new FileReader();
    reader.onload = function (event) {
        var imgObj = new Image();
        imgObj.src = event.target.result;
        imgObj.onload = function () {
            var image = new fabric.Image(imgObj);
            image.set({
                angle: 0,
                padding: 10,
                cornersize: 10,
                height: imgObj.height,
                width: imgObj.width,
            });
            canvas.clear();
            canvas.add(image);
            canvas.setActiveObject(image);
        }
    }
    reader.readAsDataURL(e.target.files[0]);
});

// Enable drawing
var drawingModeEl = document.createElement('button');
drawingModeEl.textContent = 'Toggle Drawing Mode';
drawingModeEl.onclick = function() {
    canvas.isDrawingMode = !canvas.isDrawingMode;
    if (canvas.isDrawingMode) {
        drawingModeEl.textContent = 'Cancel Drawing Mode';
    } else {
        drawingModeEl.textContent = 'Toggle Drawing Mode';
    }
};
document.body.appendChild(drawingModeEl);


// تطبيق الأبيض والأسود
document.getElementById('grayscale').addEventListener('click', function() {
    var obj = canvas.getActiveObject();
    if (!obj) return alert('الرجاء اختيار صورة');
    obj.filters.push(new fabric.Image.filters.Grayscale());
    obj.applyFilters();
    canvas.renderAll();
});

// زيادة السطوع
document.getElementById('brightness').addEventListener('click', function() {
    var obj = canvas.getActiveObject();
    if (!obj) return alert('الرجاء اختيار صورة');
    var filter = new fabric.Image.filters.Brightness({
        brightness: 0.05 // قيمة زيادة السطوع، قد تحتاج لتعديلها
    });
    obj.filters.push(filter);
    obj.applyFilters();
    canvas.renderAll();
});

// زيادة التباين
document.getElementById('contrast').addEventListener('click', function() {
    var obj = canvas.getActiveObject();
    if (!obj) return alert('الرجاء اختيار صورة');
    var filter = new fabric.Image.filters.Contrast({
        contrast: 10 // قيمة زيادة التباين، قد تحتاج لتعديلها
    });
    obj.filters.push(filter);
    obj.applyFilters();
    canvas.renderAll();
});

let state = [];
let mods = 0;

function updateState() {
    // Save the current state
    state.push(JSON.stringify(canvas));
}

canvas.on('object:modified', function() {
    updateState();
    mods = 0;
});

document.getElementById('addText').addEventListener('click', function() {
    var text = new fabric.IText('اكتب هنا...', { left: 100, top: 100 });
    canvas.add(text);
    updateState();
});

document.getElementById('undo').addEventListener('click', function() {
    if (mods < state.length) {
        canvas.clear().renderAll();
        canvas.loadFromJSON(state[state.length - 1 - mods - 1]);
        canvas.renderAll();
        mods += 1;
    }
});

document.getElementById('redo').addEventListener('click', function() {
    if (mods > 0) {
        canvas.clear().renderAll();
        canvas.loadFromJSON(state[state.length - 1 - mods + 1]);
        canvas.renderAll();
        mods -= 1;
    }
});

document.getElementById('saturation').addEventListener('click', function() {
    var obj = canvas.getActiveObject();
    if (!obj) return alert('الرجاء اختيار صورة');
    var filter = new fabric.Image.filters.Saturation({
        saturation: 0.3 // زيادة التشبع، قد تحتاج لتعديلها
    });
    obj.filters.push(filter);
    obj.applyFilters();
    canvas.renderAll();
});

updateState();


document.getElementById('resize').addEventListener('click', function() {
    var obj = canvas.getActiveObject();
    if (!obj) return alert('الرجاء اختيار صورة');
    // تغيير حجم إلى 50% من الحجم الأصلي كمثال
    obj.scaleX /= 2;
    obj.scaleY /= 2;
    obj.setCoords();
    canvas.renderAll();
    updateState();
});


document.getElementById('blur').addEventListener('click', function() {
    var obj = canvas.getActiveObject();
    if (!obj) return alert('الرجاء اختيار صورة');
    var filter = new fabric.Image.filters.Blur({
        blur: 0.5 // قيمة الضبابية، قد تحتاج لتعديلها
    });
    obj.filters.push(filter);
    obj.applyFilters();
    canvas.renderAll();
});





document.getElementById('exportImage').addEventListener('click', function() {
    var imageData = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
    var link = document.createElement('a');
    link.download = "edited-image.png";
    link.href = imageData;
    link.click();
});





var cropper;
document.getElementById('imageLoader').addEventListener('change', function (e) {
    var files = e.target.files;
    var done = function (url) {
        document.getElementById('image').src = url;
        document.getElementById('image').style.display = 'block';
        if (cropper) {
            cropper.destroy();
        }
        cropper = new Cropper(document.getElementById('image'), {
            viewMode: 1,
            autoCropArea: 1,
            movable: false,
            rotatable: false,
            scalable: false,
            zoomable: true,
            autoCrop: true,
            autoCropArea: 1,
            resizable: false,
            crop: function(event) {
                // Handle the crop event here
            }
        });
    };
    var reader;
    var file;
    var url;

    if (files && files.length > 0) {
        file = files[0];
        if (URL) {
            done(URL.createObjectURL(file));
        } else if (FileReader) {
            reader = new FileReader();
            reader.onload = function (e) {
                done(reader.result);
            };
            reader.readAsDataURL(file);
        }
    }
});




</script>
</body>
</html>
